{% extends 'base.html' %}

{% block title %}Realtime{% endblock %}

{% block head %} {% endblock %}

{% block body %}
	<div class="row">
		<div class="col-md-4" style="border-right: 1px solid grey;">		
			{% include 'arduino.html' %}
		</div>
		<div class="col-md-8">
			<div>
				<h3><span class="fas fa-clock"></span> Realtime
					<small class="badge badge-pill badge-success text-white"><span class="fas fa-rss"></span></small>
					<i class="fas fa-spinner"></i>
				</h3>
			</div>
			<hr>
			<div class="container" style="overflow-y: scroll;">
				<div class="card-header">
					<form class="form-inline justify-content-end">
						<div class="input-group mb-2 mr-sm-2 mb-sm-0">
							<!-- <input type="text" class="form-control" id="yourEmail" placeholder="Your Email"> -->
							<select class="form-control">
								<option>Transmitter 21</option>
								<option>Transmitter 22</option>
								<option>Transmitter 25</option>
							</select>
						</div>
						<button type="button" class="btn btn-md btn-primary fas fa-paper-plane" style="margin-right: 5px;"></button>
						<button type="button" class="btn btn-md btn-success fas fa-walking" style="margin-right: 5px;"></button>
						<button type="button" class="btn btn-md btn-danger fas fa-stop"></button>
					</form>
				</div>
				<canvas id="myChart" width="700" height="450" style="margin: auto;"></canvas>
			</div>
		</div>
	</div>
{% endblock %}
{% block script %}
<script language="javascript" src="{{ url_for('static', filename='js/chart.min.js') }}"></script>
<script>
	$(document).ready(function() {
		Chart.defaults.global.responsive = false;

		var times = {{times|safe}};

		var data = {{water_distance|safe}};

		var legend = "Water distance from sensor";

		var chartData = {
			labels : times,
			datasets: [
				{
					label: legend,
					fill: true,
					lineTension: 0.1,
					backgroundColor: "rgba(75,192,192,0.4)",
					borderColor: "rgba(75,192,192,1)",
					borderCapStyle: 'butt',
					borderDash: [],
					borderDashOffset: 0.0,
					borderJoinStyle: 'miter',
					pointBorderColor: "rgba(75,192,192,1)",
					pointBackgroundColor: "#fff",
					pointBorderWidth: 1,
					pointHoverRadius: 5,
					pointHoverBackgroundColor: "rgba(75,192,192,1)",
					pointHoverBorderColor: "rgba(220,220,220,1)",
					pointHoverBorderWidth: 2,
					pointRadius: 1,
					pointHitRadius: 10,
					data: data,
					spanGaps: false,
					options: {
						scales: {
							yAxes: [{
								ticks: {
									reverse: true,
									beginAtZero:true,
									start: 0,
								}
							}],
							xAxes: [{
									ticks: {
									reverse: true,
									beginAtZero: true,
									start: 0,
								}
							}]
						},
						rotation: (0.5 * Math.PI)
					}
				}
			]
		};

		var holder = document.getElementById("myChart");
		var ctx = document.getElementById("myChart").getContext("2d");

		// create the chart using the chart canvas
		var myChart = new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: {
          tooltips: {
            enabled: true,
            mode: 'single',
            callbacks: {
              label: function(tooltipItems, data) {
                       return tooltipItems.yLabel + ' degrees';
                     }
            }
          },
        }
      });

      // get the text element below the chart
      var pointSelected = document.getElementById("pointSelected");

      // create a callback function for updating the selected index on the chart
      holder.onclick = function(evt){
        var activePoint = myChart.getElementAtEvent(evt);
        console.log(activePoint);
        console.log('x:' + activePoint[0]._view.x);
        console.log('maxWidth: ' + activePoint[0]._xScale.maxWidth);
        console.log('y: ' + activePoint[0]._view.y);
        console.log('index: ' + activePoint[0]._index);
        pointSelected.innerHTML = 'Point selected... index: ' + activePoint[0]._index;
      };
	});
</script>
{% endblock %}